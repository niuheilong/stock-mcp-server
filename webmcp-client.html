<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock MCP - WebMCP è‚¡ç¥¨æ•°æ®æœåŠ¡</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .header h1 {
            margin: 0 0 10px 0;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin-top: 10px;
        }
        .status.connected {
            background: #4caf50;
            color: white;
        }
        .status.disconnected {
            background: #f44336;
            color: white;
        }
        .tool-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .tool-card h3 {
            margin-top: 0;
            color: #333;
        }
        .input-group {
            margin: 10px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
        }
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        button:hover {
            background: #5568d3;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #667eea;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }
        .error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š Stock MCP Server</h1>
        <p>WebMCP è‚¡ç¥¨æ•°æ®æœåŠ¡ - å®æ—¶ A è‚¡è¡Œæƒ…æŸ¥è¯¢</p>
        <span id="webmcp-status" class="status disconnected">WebMCP æœªè¿æ¥</span>
    </div>

    <div class="info-box">
        <strong>ğŸ’¡ æç¤ºï¼š</strong>æœ¬é¡µé¢æ”¯æŒ WebMCP åè®®ã€‚è¯·ç¡®ä¿ Stock MCP Server æ­£åœ¨è¿è¡Œï¼ˆpython stock_mcp_server.pyï¼‰ï¼Œå¹¶å·²åœ¨ Chrome ä¸­å¯ç”¨ WebMCP åŠŸèƒ½ã€‚
    </div>

    <!-- å·¥å…·1ï¼šè·å–è‚¡ä»· -->
    <div class="tool-card">
        <h3>ğŸ” è·å–è‚¡ç¥¨å®æ—¶ä»·æ ¼</h3>
        <div class="input-group">
            <label>è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ï¼š600519ã€000001ï¼‰</label>
            <input type="text" id="symbol-price" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç " value="600519">
        </div>
        <button onclick="getStockPrice()">æŸ¥è¯¢è‚¡ä»·</button>
        <div id="result-price" class="result" style="display:none"></div>
    </div>

    <!-- å·¥å…·2ï¼šæœç´¢è‚¡ç¥¨ -->
    <div class="tool-card">
        <h3>ğŸ” æœç´¢è‚¡ç¥¨</h3>
        <div class="input-group">
            <label>å…³é”®è¯ï¼ˆå¦‚ï¼šèŒ…å°ã€å¹³å®‰ã€æ–°èƒ½æºï¼‰</label>
            <input type="text" id="keyword-search" placeholder="è¾“å…¥å…³é”®è¯" value="èŒ…å°">
        </div>
        <button onclick="searchStock()">æœç´¢</button>
        <div id="result-search" class="result" style="display:none"></div>
    </div>

    <!-- å·¥å…·3ï¼šè·å–Kçº¿ -->
    <div class="tool-card">
        <h3>ğŸ“ˆ è·å–Kçº¿æ•°æ®</h3>
        <div class="input-group">
            <label>è‚¡ç¥¨ä»£ç </label>
            <input type="text" id="symbol-kline" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç " value="600519">
        </div>
        <div class="input-group">
            <label>å¤©æ•°</label>
            <input type="number" id="days-kline" placeholder="å¤©æ•°" value="10">
        </div>
        <button onclick="getKline()">è·å–Kçº¿</button>
        <div id="result-kline" class="result" style="display:none"></div>
    </div>

    <!-- å·¥å…·4ï¼šè·å–æ¿å—æ•°æ® -->
    <div class="tool-card">
        <h3>ğŸ­ è·å–æ¿å—æ•°æ®</h3>
        <div class="input-group">
            <label>æ¿å—åç§°ï¼ˆå¦‚ï¼šåŠå¯¼ä½“ã€èŠ¯ç‰‡ã€æ–°èƒ½æºæ±½è½¦ï¼‰</label>
            <input type="text" id="sector-name" placeholder="è¾“å…¥æ¿å—åç§°" value="åŠå¯¼ä½“">
        </div>
        <button onclick="getSectorData()">æŸ¥è¯¢æ¿å—</button>
        <div id="result-sector" class="result" style="display:none"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';

        // æ£€æŸ¥ WebMCP çŠ¶æ€
        async function checkWebMCP() {
            if ('modelContext' in navigator) {
                document.getElementById('webmcp-status').textContent = 'WebMCP å·²å°±ç»ª';
                document.getElementById('webmcp-status').className = 'status connected';
                
                // æ³¨å†Œå·¥å…·åˆ° WebMCP
                try {
                    await registerTools();
                } catch (e) {
                    console.log('WebMCP æ³¨å†Œå¤±è´¥ï¼ˆå¯èƒ½æœªé™„åŠ æ ‡ç­¾é¡µï¼‰:', e);
                }
            } else {
                document.getElementById('webmcp-status').textContent = 'WebMCP ä¸å¯ç”¨';
                document.getElementById('webmcp-status').className = 'status disconnected';
            }
        }

        // æ³¨å†Œå·¥å…·åˆ° WebMCP
        async function registerTools() {
            // è·å–è‚¡ä»·å·¥å…·
            await navigator.modelContext.registerTool({
                name: "stock_get_price",
                description: "è·å–Aè‚¡å®æ—¶è‚¡ä»·",
                inputSchema: {
                    type: "object",
                    properties: {
                        symbol: { type: "string", description: "è‚¡ç¥¨ä»£ç ï¼Œå¦‚600519" }
                    },
                    required: ["symbol"]
                },
                async execute({ symbol }) {
                    const response = await fetch(`${API_BASE}/mcp/call`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ tool: "get_stock_price", args: { symbol } })
                    });
                    return await response.json();
                }
            });

            // æœç´¢è‚¡ç¥¨å·¥å…·
            await navigator.modelContext.registerTool({
                name: "stock_search",
                description: "æœç´¢è‚¡ç¥¨",
                inputSchema: {
                    type: "object",
                    properties: {
                        keyword: { type: "string", description: "æœç´¢å…³é”®è¯" }
                    },
                    required: ["keyword"]
                },
                async execute({ keyword }) {
                    const response = await fetch(`${API_BASE}/mcp/call`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ tool: "search_stock", args: { keyword } })
                    });
                    return await response.json();
                }
            });

            console.log('âœ… å·¥å…·å·²æ³¨å†Œåˆ° WebMCP');
        }

        // è·å–è‚¡ä»·
        async function getStockPrice() {
            const symbol = document.getElementById('symbol-price').value;
            const resultDiv = document.getElementById('result-price');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æŸ¥è¯¢ä¸­...';

            try {
                const response = await fetch(`${API_BASE}/mcp/call`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tool: "get_stock_price", args: { symbol } })
                });
                const data = await response.json();
                resultDiv.textContent = JSON.stringify(data, null, 2);
                resultDiv.classList.remove('error');
            } catch (e) {
                resultDiv.textContent = 'é”™è¯¯: ' + e.message + '\n\nè¯·ç¡®ä¿ Stock MCP Server æ­£åœ¨è¿è¡Œ (python stock_mcp_server.py)';
                resultDiv.classList.add('error');
            }
        }

        // æœç´¢è‚¡ç¥¨
        async function searchStock() {
            const keyword = document.getElementById('keyword-search').value;
            const resultDiv = document.getElementById('result-search');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æœç´¢ä¸­...';

            try {
                const response = await fetch(`${API_BASE}/mcp/call`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tool: "search_stock", args: { keyword, limit: 10 } })
                });
                const data = await response.json();
                resultDiv.textContent = JSON.stringify(data, null, 2);
                resultDiv.classList.remove('error');
            } catch (e) {
                resultDiv.textContent = 'é”™è¯¯: ' + e.message;
                resultDiv.classList.add('error');
            }
        }

        // è·å–Kçº¿
        async function getKline() {
            const symbol = document.getElementById('symbol-kline').value;
            const days = parseInt(document.getElementById('days-kline').value);
            const resultDiv = document.getElementById('result-kline');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'è·å–ä¸­...';

            try {
                const response = await fetch(`${API_BASE}/mcp/call`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tool: "get_stock_kline", args: { symbol, days } })
                });
                const data = await response.json();
                resultDiv.textContent = JSON.stringify(data, null, 2);
                resultDiv.classList.remove('error');
            } catch (e) {
                resultDiv.textContent = 'é”™è¯¯: ' + e.message;
                resultDiv.classList.add('error');
            }
        }

        // è·å–æ¿å—æ•°æ®
        async function getSectorData() {
            const sectorName = document.getElementById('sector-name').value;
            const resultDiv = document.getElementById('result-sector');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æŸ¥è¯¢ä¸­...';

            try {
                const response = await fetch(`${API_BASE}/mcp/call`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tool: "get_sector_data", args: { sector_name: sectorName } })
                });
                const data = await response.json();
                resultDiv.textContent = JSON.stringify(data, null, 2);
                resultDiv.classList.remove('error');
            } catch (e) {
                resultDiv.textContent = 'é”™è¯¯: ' + e.message;
                resultDiv.classList.add('error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ WebMCP
        window.onload = checkWebMCP;
    </script>
</body>
</html>